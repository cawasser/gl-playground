shadow$provide.module$node_modules$golden_layout$dist$cjs$ts$controls$browser_popout=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});exports.BrowserPopout=void 0;const resolved_config_1=require("module$node_modules$golden_layout$dist$cjs$ts$config$resolved_config"),external_error_1=require("module$node_modules$golden_layout$dist$cjs$ts$errors$external_error"),internal_error_1=require("module$node_modules$golden_layout$dist$cjs$ts$errors$internal_error");
global=require("module$node_modules$golden_layout$dist$cjs$ts$utils$event_emitter");const utils_1=require("module$node_modules$golden_layout$dist$cjs$ts$utils$utils");class BrowserPopout extends global.EventEmitter{constructor(_config,_initialWindowSize,_layoutManager){super();this._config=_config;this._initialWindowSize=_initialWindowSize;this._layoutManager=_layoutManager;this._isInitialised=!1;this._popoutWindow=null;this.createWindow()}toConfig(){var _b;if(!1===this._isInitialised)throw Error("Can't create config, layout not yet initialised");
const glInstanceConfig=this.getGlInstance().saveLayout();let left;if(null===this._popoutWindow)var _a=left=null;else left=null!==(_a=this._popoutWindow.screenX)&&void 0!==_a?_a:this._popoutWindow.screenLeft,_a=null!==(_b=this._popoutWindow.screenY)&&void 0!==_b?_b:this._popoutWindow.screenTop;_b={width:this.getGlInstance().width,height:this.getGlInstance().height,left,top:_a};return{root:glInstanceConfig.root,openPopouts:glInstanceConfig.openPopouts,settings:glInstanceConfig.settings,dimensions:glInstanceConfig.dimensions,
header:glInstanceConfig.header,window:_b,parentId:this._config.parentId,indexInParent:this._config.indexInParent,resolved:!0}}getGlInstance(){if(null===this._popoutWindow)throw new internal_error_1.UnexpectedNullError("BPGGI24693");return this._popoutWindow.__glInstance}getWindow(){if(null===this._popoutWindow)throw new internal_error_1.UnexpectedNullError("BPGW087215");return this._popoutWindow}close(){if(this.getGlInstance())this.getGlInstance().closeWindow();else try{this.getWindow().close()}catch(e){}}popIn(){let index=
this._config.indexInParent;if(this._config.parentId){var parentItem=this.getGlInstance().saveLayout();var copiedRoot=utils_1.deepExtend({},parentItem).root;if(void 0===copiedRoot)throw new internal_error_1.UnexpectedUndefinedError("BPPIR19998");var groundItem=this._layoutManager.groundItem;if(void 0===groundItem)throw new internal_error_1.UnexpectedUndefinedError("BPPIG34972");parentItem=groundItem.getItemsByPopInParentId(this._config.parentId)[0];parentItem||(parentItem=0<groundItem.contentItems.length?
groundItem.contentItems[0]:groundItem,index=0);copiedRoot=this._layoutManager.createAndInitContentItem(copiedRoot,parentItem);parentItem.addChild(copiedRoot,index);this._layoutManager.layoutConfig.settings.popInOnClose?this._onClose():this.close()}}createWindow(){const url=this.createUrl(),target=Math.floor(1E6*Math.random()).toString(36),features=this.serializeWindowFeatures({width:this._initialWindowSize.width,height:this._initialWindowSize.height,innerWidth:this._initialWindowSize.width,innerHeight:this._initialWindowSize.height,
menubar:"no",toolbar:"no",location:"no",personalbar:"no",resizable:"yes",scrollbars:"no",status:"no"});if(this._popoutWindow=globalThis.open(url,target,features))this._popoutWindow.addEventListener("load",()=>this.positionWindow(),{passive:!0}),this._popoutWindow.addEventListener("beforeunload",()=>{this._layoutManager.layoutConfig.settings.popInOnClose?this.popIn():this._onClose()},{passive:!0}),this._checkReadyInterval=setInterval(()=>this.checkReady(),10);else if(!0===this._layoutManager.layoutConfig.settings.blockedPopoutsThrowError)throw new external_error_1.PopoutBlockedError("Popout blocked");
}checkReady(){if(null===this._popoutWindow)throw new internal_error_1.UnexpectedNullError("BPCR01844");this._popoutWindow.__glInstance&&this._popoutWindow.__glInstance.isInitialised&&(this.onInitialised(),void 0!==this._checkReadyInterval&&(clearInterval(this._checkReadyInterval),this._checkReadyInterval=void 0))}serializeWindowFeatures(windowOptions){const windowOptionsString=[];for(const key in windowOptions)windowOptionsString.push(key+"\x3d"+windowOptions[key].toString());return windowOptionsString.join(",")}createUrl(){const storageKey=
"gl-window-config-"+utils_1.getUniqueId();var config=resolved_config_1.ResolvedLayoutConfig.minifyConfig(this._config);try{localStorage.setItem(storageKey,JSON.stringify(config))}catch(e){throw Error("Error while writing to localStorage "+e.toString());}config=document.location.href.split("?");return 1===config.length?config[0]+"?gl-window\x3d"+storageKey:document.location.href+"\x26gl-window\x3d"+storageKey}positionWindow(){if(null===this._popoutWindow)throw Error("BrowserPopout.positionWindow: null popoutWindow");
this._popoutWindow.moveTo(this._initialWindowSize.left,this._initialWindowSize.top);this._popoutWindow.focus()}onInitialised(){this._isInitialised=!0;this.getGlInstance().on("popIn",()=>this.popIn());this.emit("initialised")}_onClose(){setTimeout(()=>this.emit("closed"),50)}}exports.BrowserPopout=BrowserPopout}
//# sourceMappingURL=module$node_modules$golden_layout$dist$cjs$ts$controls$browser_popout.js.map
